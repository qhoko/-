В этом разделе мы объясним, что такое межсайтовый скриптинг, опишем различные виды уязвимостей межсайтового скриптинга и расскажем, как обнаружить и предотвратить межсайтовый скрипт.

Что такое межсайтовый скриптинг (XSS)?
Межсайтовый скриптинг (также известный как XSS) - это уязвимость веб-безопасности, которая позволяет злоумышленнику скомпрометировать взаимодействие пользователей с уязвимым приложением. Она позволяет злоумышленнику обойти политику одного и того же источника, которая предназначена для разделения различных веб-сайтов друг от друга. Уязвимости межсайтовонго скриптинга оюбычно позволяют злоумышленнику маскироваться под пользователя-жертву, выполнять любые действия, которые может выполнять пользователь, и получать доступ к любым данным пользователя. Если пользователь-жертва имеет привилегированный доступ в приложении, то злоумышленник может получить полный контроль над всеми функциями и данными приложения.

Как работает XSS?
Межсайтовый скриптинг работает путем манипулирования уязвимым веб-сайтом, что бы он возвращал вредоносный JavaScript пользователям. Когда вредоносный код выполняется внутри браузера жертвы, ззлоумышленник может полностью скомпрометировать ее взаимодействие с приложением.
![image](https://github.com/user-attachments/assets/970bd388-0e2e-43c6-a48b-19bdc61279ec)

Доказательство концепции XSS
Вы можете подтвердить большминсвтво видов уязвимости XSS, внедрив полезную нагрузку, которая заставляет ваш собствнный браузер выполнять произвольный JavaScript, использование alert() функции для этой цели давно стало обычной практикой, поскольку она короткая, безвредная и ее довольно сложно не заметить, когда она успешно вызывается. Фактически, вы решаете большинство лабораторных работ XSS, вызывая ее alert() в браузере имитируемой жертвы.

К сожалению, есть небольшая заминка, если вы используете Chrome. Начиная с версии 92 (20 июля 2021 г. кросс-источниковые iframes не могут вызывать alert(). Поскольку они используются для построения некоторых более сложных атак XSS, вам иногда нужно будет использовать альтернативную полезную нагрузку PoC. В этом сценарии мы реомендуем функцию print().

Поскольку имитируемая жертва в наших лабораториях использует Chrome, мы внесли изменения в затронутые лаборатории, чтобы их также можно было решить с помощью print(). Мы указали это винструкциях, где это уместно.

Какие существуют типы XSS-атак?
Существуют три основных типа атак XSS. Это: 
Отражённых XSS, где вредоносный скрипт исходит из текущего HTTP-запроса.
Сохранённый XSS, где вредоносный скрипт берется из базы данных веб-сайта.
XSS на основе DOM, где уязвимость суещствует в клиентском коде, а не в серверном коде.

Отраженный межсайтовый скриптинг
Отраженный XSS - это простейшая разновидность межсайтового скриптинга. Он возникает когда приложение получает данные в HTTP-запросе и включает эти данные в немедленный ответ небезопасным способом
Вот простой пример отраженной XSS-уязвимости: 
https://insecure-website.com/status?message=All+is+well. <p>Status: All is well.</p>
Приложение не выполняет никакой другой обработки данных, поэтому злоумышленник может легко сконструировать атаку следующим образом:
https://insecure-website.com/status?message=<script>/*+Bad+stuff+here...+*/</script>
<p>Status: <script>/* Bad stuff here... */</script></p>
Если пользователь посещает ссылку, созданную злоумышленником, то скрипт злоумышленника выполняется в браузере пользователя в контексте сеанса пользователя с приложением. В этот момент скрипт может выполнить любое действие и получить любые данные, к которым у пользователя есть доступ.

Сохраненный межсайтовый скриптинг
Хранимый XSS (также известный как постоянный илип XSS второго порядка) возникает, когда приложение получает данные из ненадежного источника и включает эти данные в свои последующие HTTP-ответы небезопасным способом.
Данные, о которых идет речь, могут быть оптравлены в приложение через HTTP-запросы; например комментарии к записи в блоге, псевдонимы пользователей в чате или контактные данные в заказе клиента. В других случаях данные могут поступать из других ненадежных источников; например, приложение веб-почты, отображающее сообщения, полученные по SMTP, маркетинговое приложение, отображающее посты в социальных сетях, или приложение сетевого мониторинга, отоюбражающее пакетные данные из сетевеого трафика.
Вот простой пример сохраненной уязвимости XSS. Приложение доски объявлений позволяет пользователям отправлять сообщения, которые отображаются для других пользоватеей:
<p>Hello, this is my message!</p>
Приложение не выполняет никакой другой обработки данных, поэтому злоумышленник может легко отправить сообщение, которе атакует других пользователей: 
<p><script>/* Bad stuff here... */</script></p>

Межсайтовый скриптинг на основе DOM
XSS на основе DOM (также известный как DOM XSS) возникает, когда приложение содерржит некоторый клиентский JavaScript, который обрабатывает данные из ненадежного источника небезопасным способом, обычно путем записи данных обратно в DOM.
В следующем примере приложение использует JavaScript для считывания значения из поля ввода и записи этэого значения в элемент HTML:
var search = document.getElementById('search').value;
var results = document.getElementById('results');
results.innerHTML = 'You searched for: ' + search;
Если злоумышленник может контролировать знаыччения поля ввода, он может легко создать вредоносное значение, которое заставит выполниться его собственный скрипт:
You searched for: <img src=1 onerror='/* Bad stuff here... */'>
В типичном случае поле ввода заполняется частью HTTP-запроса, например параметром строки запроса URL, что позволяет злоумышленнику осуществить атаку с использованием вредоносного URL-адреса таким же образом, как отраженным XSS.

Для чего можно использовать XSS?
Злоумышленник, использующий уязвимость межсайтового скриптинга, обычно может:
Выдывать себя за пользователя-жертву или маскироваться под него.
Выполнять любые действия, которые может выполнить пользователь
Читать любые данные, к которым пользователь имеет доступю
Захватить учетные данные пользователя
Выполнить виртуальную порчу веб-сайта
Внедрить троянскую функцциональность на веб-сайт.

Влияние уязвимостей XSS
Фактически воздействие атаки XSS обычно зависит от характера приложения, его функциональности и данных, а также статуса скомпрометированного пользователя.
Например:
В приложении для создания брошюр, где все пользователи анонимны, а вся информация общедоступна, вляние часто будет минимальным.
В приложениях, содержащих конфиденциальные данные, такие как банковские транзакции, электронные письма  или медицинские записи, последствия обычно будут серьезными.
Если скомпрометированный пользователь имеет повышенные привилегии в приложении, то последствия, как правило, будут критическими, что позволит злоумышленнику получить полный контртоль над уязвимым приложением и скомпрометировать всех пользователей и их данные.

Как найти и протестировать уязвимости XSS
Ручное тестирование отраженных и сохраненных XSS обычно включает отправку просчтых уникальных входных данных (например, короткой буквенно-цифровой строки_ в каждую точку входа в приложении, идентификацию каждого местополжения, где отправленные входные данные возвращаются в ответах HTTP, и индивидуальное тестирование каждого местоположения, чтобы определить, можно ли использовать соответствующим образом созданные входные данные для выполнения произвольного JavaScript. Таким образом, вы можете определить контекст в котором происходит XSS, и выбрать подходящую полезную нагрузку для ее эксплуатации.
РУчное тестирование на основе DOM XSS, возникающее из параметров URL, включает в себя аналогичный процесс: размещение некоторого простого уникального ввода в параметре, использование инструментов разработчика браузера для поиска этого ввода в DOM и тестирование каждого местоположения, чтобы определить, является ли оно эксплуатируемым. Однако другие типы DOM XSS сложнее обнаружить. Чтобы найти уязвимости на основе DOM в не основанном на URL вводе (например document.cookie) или не основанных на HTML стоках (например,  setTimeout), нет замены проверке кода JavaScript, нет замены ппроверке кода JavaScript, которая может быть чрезвычайно трудоемкой.

Политика безопасности контента
Политика безопасности контента (CSP) - это механизм браузера, который направлен на смягчение последствий межсайтового скриптинга и некоторых других уязвимостей. Если приложение, использующее CSP, содержит поведение, подобное XSS, то CSP может помешать или предотвратить эксплутацию уязвимости. Часто CSP можно обойти, чтобы обеспечить эксплуатацию базовой уязвимости.

Висячая инъекция разметки 
Dangling markup injection - это метод, который можно использовать для захвата данных между доменами в ситуациях, когда полный эксплоит межсайтового скриптинга невозможен из-за входных фильтров или других защит. Его часто можно использовать для захвата конфиденциальной информации, которая видна другим пользователям, включая токены CSRF, которые можно использовать для выполнения несанкционированных действий от имени пользователя.

Как предотвратить XSS-атаки
В некоторых случая предотвратить межсайтовый скриптинг не сложно, но может быть гораздо сложнее в зависимости от сложности приложения и способов обработки контролируемых пользователем данных.
В целом эффективное предотвращение уязвимостей XSS скорее всего будет включать в себя сочетание следующих мер:
Фильтровать ввод по прибытии. В точке где получен ввод пользователя фильтруйте как можно строже на основе ожидаемого или допустимого ввода.
