Еще одним потенциальным приемником, на который следует обратить внимание, является селекторная функция jQuery $(), которая может использоваться для внедрения вредоносных объектов в DOM.

jQuery раньше был чрезвычайно популярен, и классическая уязвимость DOM XSS была вызвана веб-сайтами, использующими этот селектор в сочетании с location.hashисточником для анимации или автоматической прокрутки к определенному элементу на странице. Такое поведение часто реализовывалось с помощью уязвимого hashchangeобработчика событий, похожего на следующий:

$(window).on('hashchange', function() {
	var element = $(location.hash);
	element[0].scrollIntoView();
});
Так как это hashконтролируется пользователем, злоумышленник может использовать это для внедрения вектора XSS в $()селектор-приемник. Более поздние версии jQuery исправили эту конкретную уязвимость, не позволяя вам внедрять HTML в селектор, когда ввод начинается с символа решетки ( #). Тем не менее, вы все еще можете найти уязвимый код в дикой природе.

Чтобы фактически эксплуатировать эту классическую уязвимость, вам нужно найти способ вызвать hashchangeсобытие без взаимодействия с пользователем. Один из самых простых способов сделать это — доставить ваш эксплойт через iframe:

<iframe src="https://vulnerable-website.com#" onload="this.src+='<img src=1 onerror=alert(1)>'">
В этом примере srcатрибут указывает на уязвимую страницу с пустым значением хеша. Когда iframeзагружается, к хешу добавляется вектор XSS, что приводит hashchangeк срабатыванию события.

Примечание
Даже более новые версии jQuery могут быть уязвимы через $()селектор-приемник, при условии, что у вас есть полный контроль над его входными данными из источника, не требующего #префикса.

Эта лаборатория содержит уязвимость межсайтового скриптинга на основе DOM на домашней странице. Она использует $()селекторную функцию jQuery для автоматической прокрутки к указанному посту, заголовок которого передается через location.hashсвойство.

Чтобы решить лабораторную задачу, предоставьте жертве эксплойт, который вызовет print()функцию в ее браузере.

1. Переходим в код элемента (либо через Burp) и видим уязвимый код:

![image](https://github.com/user-attachments/assets/29425f18-de3e-47e7-ac3d-1a001e48ea4b)

2. Переходим на эксплоит сервер и вставляем в тело полезную нагрузку: <iframe src="https://YOUR.LAB.URL.web-security-academy.net/#" onload="this.src+='<img src=x onerror=print()>'"</iframe>

3. Нажимаем "Магазин"(В английской версии Store(Сохранить)), затем "Доставить эксплоит жертве"
