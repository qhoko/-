Некоторые веб-сайты затрудняют XSS, ограничивая символы, которые вам разрешено использовать. Это может быть на уровне веб-сайта или путем развертывания WAF, который предотвращает попадание ваших запросов на веб-сайт. В таких ситуациях вам нужно поэкспериментировать с другими способами вызова функций, которые обходят эти меры безопасности. Один из способов сделать это — использовать throwоператор с обработчиком исключений. Это позволяет передавать аргументы функции без использования скобок. Следующий код назначает функцию alert()глобальному обработчику исключений, а throwоператор передает 1обработчику исключений (в данном случае alert). Конечным результатом является то, что alert()функция вызывается с 1аргументом.

onerror=alert;throw 1
Существует несколько способов использования этой техники для вызова функций без скобок .

Следующая лабораторная демонстрирует веб-сайт, который фильтрует определенные символы. Вам придется использовать методы, похожие на описанные выше, чтобы решить ее.

Эта лабораторная работа отражает ваш ввод в URL JavaScript, но все не так, как кажется. Сначала это кажется тривиальной задачей; однако приложение блокирует некоторые символы в попытке предотвратить атаки XSS.

Чтобы решить лабораторную работу, выполните атаку с использованием межсайтового скриптинга, которая вызывает alertфункцию со строкой, 1337содержащейся где-то в alertсообщении.

1. Переходим к любому посту и в ссылке в параметр postId= вставляем полезную нагрузку:

1&'},x=x=>{throw/**/onerror=alert,number1337},toString=x,window+'',{x:'

2. Должно получиться так: https://YOUR-LAB-ID.web-security-academy.net/post?postId=1&%27},x=x=%3E{throw/**/onerror=alert,1337},toString=x,window%2b%27%27,{x:%27

3. Лабораторная работа будет решена, но оповещение будет вызвано только в том случае, если вы нажмете «Вернуться в блог» в нижней части страницы.

Эксплойт использует обработку исключений для вызова alertфункции с аргументами. throwОператор используется, разделенный пустым комментарием, чтобы обойти ограничение на отсутствие пробелов. Функция alertназначается onerrorобработчику исключений.

Поскольку throwэто оператор, его нельзя использовать как выражение. Вместо этого нам нужно использовать стрелочные функции для создания блока, чтобы throwоператор можно было использовать. Затем нам нужно вызвать эту функцию, поэтому мы назначаем ее свойству toStringи windowактивируем ее, принудительно выполняя преобразование строки в window.

Разбор кода:

&'}...: Знак & указывает на то, что далее будет следовать другой параметр в формате key=value. В данном случае после & идет '}..., что может свидетельствовать о том, что строка заканчивается и весь блок кода является частью какого-то JavaScript-кода.

'},x=x=>{throw//onerror=alert,1337},toString=x,window+'',{x:':

x=x=>{...}: Это объявление стрелочной функции x, которая принимает один аргумент x, переписывая его самую себя.

throw: Внутри этой функции бросается исключение. Это может использоваться для прекращения выполнения текущего кода и перехода к обработчику ошибок.

onerror=alert: Здесь устанавливается обработчик события onerror, который будет вызывать функцию alert. Это означает, что если произойдет ошибка в скрипте, всплывающее окно с сообщением (в данном случае, undefined или другая ошибка) будет отображено.

1337: Число 1337 часто используется в сленге программирования и является частью "leet speak". Возможно, это просто пример значения, которое возвращается вместе с ошибкой.

toString=x: Операция переназначения, где метод toString объекта теперь также ссылается на функцию x.

window+'': Это конкатенация окна браузера (объект window) с пустой строкой, что вернет строковое представление объекта window. Это может быть использовано для создания некоторого тега или значения, которое не приводит к ошибке.
