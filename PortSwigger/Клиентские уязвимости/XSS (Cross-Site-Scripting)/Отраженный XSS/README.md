## Что такое отражённый межсайтовый скриптинг?
Отражённый межсайтовый скриптинг (или XSS) возникает, когда приложение получает данные в HTTP-запросе и включает эти данные в немедленный ответ небезопасным способом.

### Пример:
Предположим, что на веб-сайте есть функция поиска, которая получает введённый пользователем поисковый запрос в параметре URL:

```
https://insecure-website.com/search?term=gift
```

Приложение повторяет указанный поисковый запрос в ответе на этот URL:

```html
<p>You searched for: gift</p>
```

Если предположить, что приложение не выполняет никакой другой обработки данных, злоумышленник может сконструировать атаку следующим образом:

```
https://insecure-website.com/search?term=<script>/*+Bad+stuff+here...+*/</script>
```

Этот URL-адрес приводит к следующему ответу:

```html
<p>You searched for: <script>/* Bad stuff here... */</script></p>
```

Если другой пользователь приложения запросит URL-адрес злоумышленника, то предоставленный злоумышленником скрипт будет выполнен в браузере пользователя-жертвы в контексте его сеанса работы с приложением.

# Лаба по этой теме: [![Open Lab](https://img.shields.io/badge/Open-Lab-blue)](./01.%20%28%D0%A3%D1%87%D0%B5%D0%BD%D0%B8%D0%BA%29%20%D0%9E%D1%82%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B5%20XSS%20%D0%B2%20HTML-%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B5%20%D0%B1%D0%B5%D0%B7%20%D0%BA%D0%BE%D0%B4%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F.md)

---

## Влияние отражённых XSS-атак
Если злоумышленник может контролировать скрипт, который выполняется в браузере жертвы, то он, как правило, может полностью скомпрометировать этого пользователя. Среди прочего, злоумышленник может:

- Выполнять любые действия в приложении, которые может выполнять пользователь.
- Просматривать любую информацию, которую пользователь может просматривать.
- Изменять любую информацию, которую пользователь может изменить.
- Инициировать взаимодействие с другими пользователями приложения, включая вредоносные атаки, которые будут исходить от первоначального пользователя-жертвы.

Существуют различные способы, с помощью которых злоумышленник может заставить пользователя-жертву сделать контролируемый им запрос, чтобы осуществить отражённую атаку XSS. К ним относятся:

- Размещение ссылок на веб-сайте, контролируемом злоумышленником, или на другом веб-сайте, который позволяет генерировать контент.
- Отправка ссылки в электронном письме, твите или другом сообщении.

Атака может быть направлена непосредственно против известного пользователя или может быть неизбирательной атакой против любых пользователей приложения.

Необходимость внешнего механизма доставки для атаки означает, что воздействие отражённого XSS, как правило, менее серьёзно, чем воздействие сохранённого XSS, когда автономная атака может быть реализована внутри самого уязвимого приложения.

---

## Отражённый XSS в разных контекстах
Существует множество различных разновидностей отражённого межсайтового скриптинга. Расположение отражённых данных в ответе приложения определяет, какой тип полезной нагрузки требуется для его эксплуатации, а также может повлиять на воздействие уязвимости.

Кроме того, если приложение выполняет какую-либо проверку или иную обработку отправленных данных перед их отражением, это, как правило, влияет на то, какой тип полезной нагрузки XSS необходим.

---

## Как найти и протестировать отражённые XSS-уязвимости

Тестирование на наличие отражённых XSS-уязвимостей вручную включает следующие этапы:

1. **Тестируйте каждую точку входа.** Тестируйте отдельно каждую точку входа для данных в HTTP-запросах приложения. Это включает параметры или другие данные в строке запроса URL, теле сообщения, а также путь к файлу URL. Это также включает заголовки HTTP, хотя поведение, подобное XSS, которое может быть вызвано только через определённые заголовки HTTP, может не поддаваться эксплуатации на практике.

2. **Отправьте случайные буквенно-цифровые значения.** Для каждой точки входа отправьте уникальное случайное значение и определите, отражено ли это значение в ответе. Значение должно быть разработано так, чтобы выдерживать большинство проверок ввода, поэтому оно должно быть достаточно коротким и содержать только буквенно-цифровые символы. Но оно должно быть достаточно длинным, чтобы случайные совпадения в ответе были крайне маловероятны. Обычно идеальным вариантом является случайное буквенно-цифровое значение из примерно 8 символов. Вы можете использовать числовые полезные нагрузки Burp Intruder со случайно сгенерированными шестнадцатеричными значениями для генерации подходящих случайных значений. И вы можете использовать настройки полезных нагрузок grep Burp Intruder для автоматической пометки ответов, содержащих отправленное значение.

3. **Определите контекст отражения.** Для каждого места в ответе, где отражается случайное значение, определите его контекст. Это может быть текст между тегами HTML, внутри атрибута тега, который может быть заключён в кавычки, внутри строки JavaScript и т. д.

4. **Тестирование потенциальной полезной нагрузки.** На основе контекста отражения протестируйте первоначальную потенциально-полезную нагрузку XSS, которая запустит выполнение JavaScript, если она будет отражена в ответе без изменений. Самый простой способ тестирования полезной нагрузки — отправить запрос в Burp Repeater, изменить запрос, чтобы вставить потенциально-полезную нагрузку, выполнить запрос, а затем просмотреть ответ, чтобы увидеть, сработала ли полезная нагрузка. Эффективный способ работы — оставить исходное случайное значение в запросе и поместить потенциально-полезную нагрузку XSS до или после него. Затем установите случайное значение в качестве поискового термина в представлении ответа Burp Repeater. Burp выделит каждое место, где появляется поисковый термин, что позволит вам быстро найти отражение.

5. **Тестируйте альтернативные полезные нагрузки.** Если потенциальная полезная нагрузка XSS была изменена приложением или полностью заблокирована, вам нужно будет протестировать альтернативные полезные нагрузки и методы, которые могут обеспечить рабочую атаку XSS на основе контекста отражения и типа выполняемой проверки входных данных. Для получения более подробной информации см. контексты межсайтового скриптинга.

6. **Протестируйте атаку в браузере.** Наконец, если вам удастся найти полезную нагрузку, которая, по-видимому, работает в Burp Repeater, перенесите атаку в реальный браузер (вставив URL в адресную строку или изменив запрос в представлении перехвата Burp Proxy) и посмотрите, действительно ли выполняется внедрённый JavaScript. Часто лучше всего выполнить какой-нибудь простой JavaScript, например, `alert(document.domain)`, который вызовет видимое всплывающее окно в браузере, если атака будет успешной.

---

## Часто задаваемые вопросы об отражённом межсайтовом скриптинге

### В чём разница между отражённым XSS и сохранённым XSS?
- **Отражённый XSS** возникает, когда приложение берёт некоторые входные данные из HTTP-запроса и встраивает эти данные в немедленный ответ небезопасным способом.
- **Сохранённый XSS**: данные сохраняются и используются в более позднем ответе небезопасным способом.

### В чём разница между отражённым XSS и самостоятельным XSS?
- **Самостоятельный XSS** подразумевает похожее поведение приложения, что и обычный отражённый XSS, однако его нельзя запустить обычными способами через созданный URL или кросс-доменный запрос. Вместо этого уязвимость активируется только в том случае, если жертва сама отправляет полезную нагрузку XSS из своего браузера. Доставка атаки самостоятельным XSS обычно включает в себя социальную инженерию жертвы, чтобы она вставила некоторые предоставленные злоумышленником данные в свой браузер. Таким образом, это обычно считается неубедительной проблемой с низким уровнем воздействия.
