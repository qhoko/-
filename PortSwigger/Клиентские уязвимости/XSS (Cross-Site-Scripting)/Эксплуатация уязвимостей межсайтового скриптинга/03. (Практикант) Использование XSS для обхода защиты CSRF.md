Использование межсайтового скриптинга для обхода защиты CSRF
XSS позволяет злоумышленнику делать практически все, что может делать на веб-сайте законный пользователь. Выполняя произвольный JavaScript в браузере жертвы, XSS позволяет вам выполнять широкий спектр действий, как если бы вы были пользователем-жертвой. Например, вы можете заставить жертву отправить сообщение, принять запрос на добавление в друзья, зафиксировать бэкдор в репозитории исходного кода или перевести немного биткоинов.

Некоторые веб-сайты позволяют вошедшим в систему пользователям менять свой адрес электронной почты без повторного ввода пароля. Если вы обнаружили уязвимость XSS на одном из этих сайтов, вы можете воспользоваться ею, чтобы украсть токен CSRF. С помощью токена вы можете изменить адрес электронной почты жертвы на тот, который вы контролируете. Затем вы можете запустить сброс пароля, чтобы получить доступ к учетной записи.

Этот тип эксплойта сочетает XSS (для кражи токена CSRF) с функциональностью, на которую обычно нацелен CSRF. В то время как традиционный CSRF является «односторонней» уязвимостью, когда злоумышленник может заставить жертву отправлять запросы, но не может видеть ответы, XSS обеспечивает «двустороннюю» связь. Это позволяет злоумышленнику как отправлять произвольные запросы, так и читать ответы, что приводит к гибридной атаке, которая обходит защиту от CSRF.

Примечание
Токены CSRF неэффективны против XSS, поскольку XSS позволяет злоумышленникам считывать значения токенов непосредственно из ответов.

Эта лаборатория содержит сохраненную уязвимость XSS в функции комментариев блога. Чтобы решить эту лабораторную задачу, воспользуйтесь уязвимостью, чтобы украсть токен CSRF, который затем можно использовать для изменения адреса электронной почты того, кто просматривает комментарии к записи блога.

Вы можете войти в свою учетную запись, используя следующие учетные данные:wiener:peter

Подсказка:
Вы не можете зарегистрировать адрес электронной почты, который уже занят другим пользователем. Если вы меняете свой адрес электронной почты во время тестирования эксплойта, используйте другой адрес электронной почты для финального эксплойта, который вы отправляете жертве.

1. Войдите в систему, используя предоставленные учетные данные. На странице учетной записи пользователя обратите внимание на функцию обновления адреса электронной почты.

![image](https://github.com/user-attachments/assets/03a01c4f-372d-442d-b715-c58762235be6)

2. Вам необходимо отправить запрос POST /my-account/change-email с параметром email.
В скрытом входе есть анти-CSRF-токен, называемый token.
Это означает, что вашему эксплойту необходимо будет загрузить страницу учетной записи пользователя, извлечь токен CSRF, а затем использовать токен для изменения адреса электронной почты жертвы.

3. Отправьте следующую полезную информацию в комментарии к блогу:

<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/my-account',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/my-account/change-email', true);
    changeReq.send('csrf='+token+'&email=test@test.com')
};
</script>

4. Это заставит любого, кто просмотрит комментарий, отправить POST-запрос на изменение своего адреса электронной почты на test@test.com.
</script>
