Поиск скрытой поверхности атаки для внедрения XXE
Поверхность атаки для уязвимостей инъекции XXE очевидна во многих случаях, поскольку обычный HTTP-трафик приложения включает запросы, содержащие данные в формате XML. В других случаях поверхность атаки менее заметна. Однако, если вы посмотрите в правильных местах, вы найдете поверхность атаки XXE в запросах, которые не содержат XML.

XInclude атаки
Некоторые приложения получают данные, отправленные клиентом, встраивают их на стороне сервера в XML-документ, а затем анализируют документ. Примером этого является случай, когда данные, отправленные клиентом, помещаются в бэкэнд-запрос SOAP, который затем обрабатывается бэкэнд-службой SOAP.

В этой ситуации вы не можете выполнить классическую атаку XXE, поскольку вы не контролируете весь XML-документ и не можете определить или изменить элемент DOCTYPE. Однако вы можете использовать XIncludeвместо этого. XInclude— это часть спецификации XML, которая позволяет создавать XML-документ из поддокументов. Вы можете поместить XIncludeатаку в любое значение данных в XML-документе, поэтому атака может быть выполнена в ситуациях, когда вы контролируете только один элемент данных, который помещается в XML-документ на стороне сервера.

Для выполнения XIncludeатаки вам необходимо сослаться на XIncludeпространство имен и указать путь к файлу, который вы хотите включить. Например:

<foo xmlns:xi="http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo>

В этой лаборатории реализована функция «Проверка запасов», которая встраивает введенные пользователем данные в серверный XML-документ, который впоследствии анализируется.

Поскольку вы не контролируете весь XML-документ, вы не можете определить DTD для запуска классической атаки XXE.

Чтобы решить лабораторную работу, введите XIncludeоператор для извлечения содержимого файла /etc/passwd.

Подсказка
По умолчанию XIncludeпопытается проанализировать включенный документ как XML. Поскольку /etc/passwdэто недопустимый XML, вам нужно будет добавить дополнительный атрибут в XIncludeдирективу, чтобы изменить это поведение.

1. Нас встречает список продуктов:

![image](https://github.com/user-attachments/assets/25e27f48-46e8-4a05-bb02-89e90a575410)

---

2. Переходим  на любой из них, включаем бурп прокси и нажимаем "Проверить наличие на складе":

![image](https://github.com/user-attachments/assets/10a3b074-fffe-434b-af2e-19cda4292f94)

---

3. В Proxy -> HTTP History POST запрос к /product/check отправляем в Repeater:

![image](https://github.com/user-attachments/assets/2aaeb314-7fab-4089-a953-86765eb9a944)

4. В ProductId меняем значение на:
<foo xmlns:xi"http://www.w3.org/2001/XInclude">
<xi:include parse="text" href="file:///etc/passwd"/></foo>

![image](https://github.com/user-attachments/assets/a8dfa8d3-c741-4eb4-8583-b383083e9e7c)

---

5. Получаем вывод файла /etc/passwd:

![image](https://github.com/user-attachments/assets/3399e0cd-2e48-4505-bd27-d2a44162825b)
---
